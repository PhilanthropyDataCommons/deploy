name: Update service image

on:
  workflow_dispatch:
    inputs:
      image-tag:
        description: 'The tag of the docker image to use'
        required: true
        type: string

jobs:
  update-service-image:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - run: git config --global user.email "update-service-image-bot@github.com"
    - run: git config --global user.name "Update Service Image Bot"
    - run: sed -i "s/ghcr\.io\/philanthropydatacommons\/service:[0-9a-z_-]*/ghcr\.io\/philanthropydatacommons\/service:${{ github.event.inputs.image-tag }}/" compose.yml
    - run: git diff
    - run: git add compose.yml
    - run: git commit -m "Auto-update service image to ${{ github.event.inputs.image-tag }}"
    - run: git log --graph --decorate --all
    - run: git push
